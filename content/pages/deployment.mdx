---
title: "Deployment"
description: "Complete guide to deploying Muni documentation to various platforms"
author: "Muni Team"
date: "2024-01-15"
---

# Deployment

Deploy your Muni documentation to any static hosting platform.

## Build for Production

First, build your documentation for production:

```bash
pnpm build
```

This will:

- Generate static HTML files
- Optimize images and assets
- Create a production-ready build in the `.next` directory

## Deployment Platforms

### Vercel (Recommended)

Vercel is the easiest way to deploy Next.js applications with zero configuration:

1. **Connect your repository**

   - Push your code to GitHub
   - Go to [vercel.com](https://vercel.com)
   - Click "New Project"
   - Import your repository

2. **Configure build settings**

   - Framework: Next.js (auto-detected)
   - Build Command: `pnpm build`
   - Output Directory: `.next`
   - Node.js Version: 18.x or 20.x

3. **Environment Variables**

   ```bash
   # Set in Vercel dashboard or via CLI
   NEXT_PUBLIC_SITE_URL=https://your-domain.com
   NEXT_PUBLIC_GITHUB_REPO=https://github.com/your-org/repo
   NEXT_PUBLIC_VERSION=1.0.0
   ```

4. **Deploy**
   - Vercel will automatically deploy on every push
   - Your site will be available at `https://your-project.vercel.app`
   - Custom domains supported with automatic SSL

### Docker Deployment

Deploy using Docker for consistent environments:

1. **Create Dockerfile**

   ```dockerfile
   # Dockerfile
   FROM node:20-alpine AS base
   
   # Install dependencies only when needed
   FROM base AS deps
   RUN apk add --no-cache libc6-compat
   WORKDIR /app
   
   # Install dependencies
   COPY package.json pnpm-lock.yaml ./
   RUN corepack enable pnpm && pnpm install --frozen-lockfile
   
   # Rebuild the source code only when needed
   FROM base AS builder
   WORKDIR /app
   COPY --from=deps /app/node_modules ./node_modules
   COPY . .
   
   # Generate search data and build
   RUN corepack enable pnpm && pnpm run generate-search && pnpm build
   
   # Production image, copy all the files and run next
   FROM base AS runner
   WORKDIR /app
   
   ENV NODE_ENV production
   
   RUN addgroup --system --gid 1001 nodejs
   RUN adduser --system --uid 1001 nextjs
   
   COPY --from=builder /app/public ./public
   COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
   COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static
   
   USER nextjs
   
   EXPOSE 3000
   
   ENV PORT 3000
   ENV HOSTNAME "0.0.0.0"
   
   CMD ["node", "server.js"]
   ```

2. **Create .dockerignore**

   ```dockerignore
   .next
   node_modules
   .git
   .gitignore
   README.md
   Dockerfile
   .dockerignore
   ```

3. **Build and run**

   ```bash
   # Build the image
   docker build -t muni-docs .
   
   # Run the container
   docker run -p 3000:3000 muni-docs
   ```

### Kubernetes Deployment

Deploy to Kubernetes for scalable, production-ready hosting:

1. **Create deployment.yaml**

   ```yaml
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: muni-docs
   spec:
     replicas: 3
     selector:
       matchLabels:
         app: muni-docs
     template:
       metadata:
         labels:
           app: muni-docs
       spec:
         containers:
         - name: muni-docs
           image: muni-docs:latest
           ports:
           - containerPort: 3000
           env:
           - name: NODE_ENV
             value: "production"
           - name: NEXT_PUBLIC_SITE_URL
             value: "https://docs.yourcompany.com"
           resources:
             requests:
               memory: "128Mi"
               cpu: "100m"
             limits:
               memory: "256Mi"
               cpu: "200m"
   ```

2. **Create service.yaml**

   ```yaml
   apiVersion: v1
   kind: Service
   metadata:
     name: muni-docs-service
   spec:
     selector:
       app: muni-docs
     ports:
     - port: 80
       targetPort: 3000
     type: LoadBalancer
   ```

3. **Deploy**

   ```bash
   kubectl apply -f deployment.yaml
   kubectl apply -f service.yaml
   ```

### Netlify

Deploy to Netlify using the Next.js plugin:

1. **Build settings**

   ```toml
   # netlify.toml
   [build]
     command = "pnpm build"
     publish = ".next"

   [[plugins]]
     package = "@netlify/plugin-nextjs"
   ```

2. **Deploy**
   - Connect your repository to Netlify
   - Deploy automatically on every push

### GitHub Pages

Deploy to GitHub Pages using GitHub Actions:

1. **Create workflow file**

   ```yaml
   # .github/workflows/deploy.yml
   name: Deploy to GitHub Pages

   on:
     push:
       branches: [main]

   jobs:
     deploy:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v3
         - uses: actions/setup-node@v3
           with:
             node-version: "18"
             cache: "pnpm"
         - run: pnpm install
         - run: pnpm build
         - uses: peaceiris/actions-gh-pages@v3
           with:
             github_token: ${{ secrets.GITHUB_TOKEN }}
             publish_dir: .next
   ```

2. **Enable GitHub Pages**
   - Go to repository Settings > Pages
   - Source: GitHub Actions
   - Your site will be available at `https://username.github.io/repository-name`

### Other Platforms

Muni works with any static hosting platform:

- **AWS S3 + CloudFront**
- **Cloudflare Pages**
- **Firebase Hosting**
- **Surge.sh**
- **Render**

## Environment Variables

Set environment variables for production:

### Vercel

```bash
vercel env add NEXT_PUBLIC_SITE_URL
vercel env add NEXT_PUBLIC_GITHUB_REPO
```

### Netlify

```bash
# In Netlify dashboard
Site Settings > Environment Variables
```

### GitHub Actions

```yaml
env:
  NEXT_PUBLIC_SITE_URL: https://your-site.com
  NEXT_PUBLIC_GITHUB_REPO: https://github.com/your-org/your-repo
```

## Custom Domain

### Vercel

1. Go to Project Settings > Domains
2. Add your custom domain
3. Update DNS records as instructed

### Netlify

1. Go to Site Settings > Domain Management
2. Add custom domain
3. Configure DNS settings

### GitHub Pages

1. Add `CNAME` file to your repository:
   ```
   your-domain.com
   ```
2. Configure DNS to point to GitHub Pages

## Performance Optimization

### Image Optimization

Use Next.js Image component for optimized images:

```jsx
import Image from "next/image";

<Image src="/images/logo.png" alt="Logo" width={200} height={100} priority />;
```

### Static Generation

All pages are statically generated for optimal performance:

```typescript
// pages/your-page.tsx
export async function getStaticProps() {
  return {
    props: {
      // your props
    },
  };
}
```

### Bundle Analysis

Analyze your bundle size:

```bash
pnpm build
pnpm analyze
```

## Monitoring

### Analytics

Add analytics to track usage:

```jsx
// components/Analytics.jsx
import Script from "next/script";

export function Analytics() {
  return (
    <>
      <Script
        src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"
        strategy="afterInteractive"
      />
      <Script id="google-analytics" strategy="afterInteractive">
        {`
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'GA_MEASUREMENT_ID');
        `}
      </Script>
    </>
  );
}
```

### Error Monitoring

Add error monitoring with Sentry:

```bash
pnpm add @sentry/nextjs
```

```javascript
// sentry.client.config.js
import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  tracesSampleRate: 1.0,
});
```

## Security

### Content Security Policy

Add CSP headers for security:

```javascript
// next.config.js
const nextConfig = {
  async headers() {
    return [
      {
        source: "/(.*)",
        headers: [
          {
            key: "Content-Security-Policy",
            value:
              "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';",
          },
        ],
      },
    ];
  },
};
```

### HTTPS

Ensure your site uses HTTPS:

- Vercel: Automatic HTTPS
- Netlify: Automatic HTTPS
- GitHub Pages: Automatic HTTPS

## Troubleshooting

### Build Errors

Common build errors and solutions:

**Module not found**

```bash
# Clear cache and reinstall
rm -rf node_modules .next
pnpm install
pnpm build
```

**TypeScript errors**

```bash
# Check TypeScript configuration
pnpm tsc --noEmit
```

**Memory issues**

```bash
# Increase Node.js memory limit
NODE_OPTIONS="--max-old-space-size=4096" pnpm build
```

### Deployment Issues

**404 errors**

- Check if all pages are properly exported
- Verify file paths and routing

**Styling issues**

- Ensure Tailwind CSS is properly configured
- Check if all CSS files are included

**Performance issues**

- Use Next.js Image component
- Optimize images and assets
- Enable compression

## 2025 Best Practices

### Performance Optimization

1. **Core Web Vitals**: Ensure good LCP, FID, and CLS scores
2. **Image Optimization**: Use Next.js Image component with WebP/AVIF
3. **Bundle Analysis**: Regularly analyze and optimize bundle size
4. **CDN Usage**: Use global CDN for static assets
5. **Caching Strategy**: Implement proper caching headers
6. **Code Splitting**: Leverage Next.js automatic code splitting

### Security

1. **HTTPS Everywhere**: Force HTTPS redirects
2. **Security Headers**: Implement CSP, HSTS, and other security headers
3. **Dependency Scanning**: Regular security audits with `npm audit`
4. **Environment Variables**: Never commit secrets to version control
5. **Access Control**: Implement proper authentication if needed
6. **Regular Updates**: Keep all dependencies updated

### Monitoring & Analytics

1. **Error Tracking**: Use Sentry or similar for error monitoring
2. **Performance Monitoring**: Track Core Web Vitals
3. **Uptime Monitoring**: Set up uptime checks
4. **Analytics**: Implement privacy-friendly analytics
5. **Logging**: Centralized logging for debugging

### CI/CD Pipeline

```yaml
# .github/workflows/deploy.yml
name: Deploy Documentation

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
      - run: pnpm install
      - run: pnpm lint
      - run: pnpm build

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
      - run: pnpm install
      - run: pnpm build
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
```

### Environment Management

```bash
# .env.local (development)
NEXT_PUBLIC_SITE_URL=http://localhost:3000
NEXT_PUBLIC_GITHUB_REPO=https://github.com/your-org/repo
NEXT_PUBLIC_VERSION=1.0.0-dev

# .env.production (production)
NEXT_PUBLIC_SITE_URL=https://docs.yourcompany.com
NEXT_PUBLIC_GITHUB_REPO=https://github.com/your-org/repo
NEXT_PUBLIC_VERSION=1.0.0
```

## Best Practices

1. **Test locally first**: Always test your build locally before deploying
2. **Use environment variables**: Don't hardcode sensitive information
3. **Optimize images**: Use appropriate formats and sizes
4. **Monitor performance**: Set up analytics and error monitoring
5. **Keep dependencies updated**: Regularly update packages for security
6. **Use HTTPS**: Always use HTTPS in production
7. **Set up redirects**: Handle old URLs and broken links
8. **Backup your content**: Keep your content in version control
9. **Implement proper caching**: Use appropriate cache headers
10. **Monitor Core Web Vitals**: Ensure good user experience metrics

## Example Deployments

### Vercel

```bash
# Install Vercel CLI
npm i -g vercel

# Deploy
vercel

# Production deployment
vercel --prod
```

### Netlify

```bash
# Install Netlify CLI
npm i -g netlify-cli

# Build and deploy
pnpm build
netlify deploy --dir=.next --prod
```

### Manual Upload

```bash
# Build the project
pnpm build

# Upload .next directory to your hosting provider
# Make sure to configure your server to serve static files
```

## Continuous Deployment

Set up automatic deployments:

### GitHub Actions

```yaml
name: Deploy
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: "18"
          cache: "pnpm"
      - run: pnpm install
      - run: pnpm build
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
```
